{"ast":null,"code":"\"use strict\";\n\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.object.define-property.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.array.filter.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.array.from.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.string.iterator.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.array.map.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.array.sort.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.number.constructor.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.array.for-each.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/web.dom-collections.for-each.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.function.name.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.array.find-index.js\");\nrequire(\"/home/bruno/repos/libs/lib-y/node_modules/core-js/modules/es.object.assign.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.tab = tab;\nvar _dom = require(\"@testing-library/dom\");\nvar _utils = require(\"./utils\");\nvar _focus = require(\"./focus\");\nvar _blur = require(\"./blur\");\nfunction getNextElement(currentIndex, shift, elements, focusTrap) {\n  if ((0, _utils.isDocument)(focusTrap) && (currentIndex === 0 && shift || currentIndex === elements.length - 1 && !shift)) {\n    return focusTrap.body;\n  }\n  var nextIndex = shift ? currentIndex - 1 : currentIndex + 1;\n  var defaultIndex = shift ? elements.length - 1 : 0;\n  return elements[nextIndex] || elements[defaultIndex];\n}\nfunction tab() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n    _ref$shift = _ref.shift,\n    shift = _ref$shift === void 0 ? false : _ref$shift,\n    focusTrap = _ref.focusTrap;\n  var _focusTrap$ownerDocum, _focusTrap;\n  var doc = (_focusTrap$ownerDocum = (_focusTrap = focusTrap) == null ? void 0 : _focusTrap.ownerDocument) != null ? _focusTrap$ownerDocum : document;\n  var previousElement = (0, _utils.getActiveElement)(doc);\n  if (!focusTrap) {\n    focusTrap = doc;\n  }\n  var focusableElements = focusTrap.querySelectorAll(_utils.FOCUSABLE_SELECTOR);\n  var enabledElements = Array.from(focusableElements).filter(function (el) {\n    return el === previousElement || el.getAttribute('tabindex') !== '-1' && !(0, _utils.isDisabled)(el) &&\n    // Hidden elements are not tabable\n    (0, _utils.isVisible)(el);\n  });\n  if (enabledElements.length === 0) return;\n  var orderedElements = enabledElements.map(function (el, idx) {\n    return {\n      el: el,\n      idx: idx\n    };\n  }).sort(function (a, b) {\n    // tabindex has no effect if the active element has tabindex=\"-1\"\n    if (previousElement && previousElement.getAttribute('tabindex') === '-1') {\n      return a.idx - b.idx;\n    }\n    var tabIndexA = Number(a.el.getAttribute('tabindex'));\n    var tabIndexB = Number(b.el.getAttribute('tabindex'));\n    var diff = tabIndexA - tabIndexB;\n    return diff === 0 ? a.idx - b.idx : diff;\n  }).map(function (_ref2) {\n    var el = _ref2.el;\n    return el;\n  }); // TODO: verify/remove type casts\n\n  var checkedRadio = {};\n  var prunedElements = [];\n  orderedElements.forEach(function (currentElement) {\n    // For radio groups keep only the active radio\n    // If there is no active radio, keep only the checked radio\n    // If there is no checked radio, treat like everything else\n    var el = currentElement;\n    if (el.type === 'radio' && el.name) {\n      // If the active element is part of the group, add only that\n      var prev = previousElement;\n      if (prev && prev.type === el.type && prev.name === el.name) {\n        if (el === prev) {\n          prunedElements.push(el);\n        }\n        return;\n      } // If we stumble upon a checked radio, remove the others\n\n      if (el.checked) {\n        prunedElements = prunedElements.filter(function (e) {\n          return e.type !== el.type || e.name !== el.name;\n        });\n        prunedElements.push(el);\n        checkedRadio[el.name] = el;\n        return;\n      } // If we already found the checked one, skip\n\n      if (typeof checkedRadio[el.name] !== 'undefined') {\n        return;\n      }\n    }\n    prunedElements.push(el);\n  });\n  var index = prunedElements.findIndex(function (el) {\n    return el === previousElement;\n  });\n  var nextElement = getNextElement(index, shift, prunedElements, focusTrap);\n  var shiftKeyInit = {\n    key: 'Shift',\n    keyCode: 16,\n    shiftKey: true\n  };\n  var tabKeyInit = {\n    key: 'Tab',\n    keyCode: 9,\n    shiftKey: shift\n  };\n  var continueToTab = true; // not sure how to make it so there's no previous element...\n  // istanbul ignore else\n\n  if (previousElement) {\n    // preventDefault on the shift key makes no difference\n    if (shift) _dom.fireEvent.keyDown(previousElement, Object.assign({}, shiftKeyInit));\n    continueToTab = _dom.fireEvent.keyDown(previousElement, Object.assign({}, tabKeyInit));\n  }\n  var keyUpTarget = !continueToTab && previousElement ? previousElement : nextElement;\n  if (continueToTab) {\n    if (nextElement === doc.body) {\n      /* istanbul ignore else */\n      if (previousElement) {\n        (0, _blur.blur)(previousElement);\n      }\n    } else {\n      (0, _focus.focus)(nextElement);\n    }\n  }\n  _dom.fireEvent.keyUp(keyUpTarget, Object.assign({}, tabKeyInit));\n  if (shift) {\n    _dom.fireEvent.keyUp(keyUpTarget, Object.assign({}, shiftKeyInit, {\n      shiftKey: false\n    }));\n  }\n}\n/*\neslint\n  complexity: \"off\",\n  max-statements: \"off\",\n*/","map":{"version":3,"mappings":"AAAA,YAAY;;AAACA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAEbC,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAC3CC,KAAK,EAAE;AACT,CAAC,CAAC;AACFD,OAAO,CAACE,GAAG,GAAGA,GAAG;AAEjB,IAAIC,IAAI,GAAGN,OAAO,CAAC,sBAAsB,CAAC;AAE1C,IAAIO,MAAM,GAAGP,OAAO,CAAC,SAAS,CAAC;AAE/B,IAAIQ,MAAM,GAAGR,OAAO,CAAC,SAAS,CAAC;AAE/B,IAAIS,KAAK,GAAGT,OAAO,CAAC,QAAQ,CAAC;AAE7B,SAASU,cAAcA,CAACC,YAAY,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,SAAS,EAAE;EAChE,IAAI,CAAC,CAAC,EAAEP,MAAM,CAACQ,UAAU,EAAED,SAAS,CAAC,KAAKH,YAAY,KAAK,CAAC,IAAIC,KAAK,IAAID,YAAY,KAAKE,QAAQ,CAACG,MAAM,GAAG,CAAC,IAAI,CAACJ,KAAK,CAAC,EAAE;IACxH,OAAOE,SAAS,CAACG,IAAI;EACvB;EAEA,IAAMC,SAAS,GAAGN,KAAK,GAAGD,YAAY,GAAG,CAAC,GAAGA,YAAY,GAAG,CAAC;EAC7D,IAAMQ,YAAY,GAAGP,KAAK,GAAGC,QAAQ,CAACG,MAAM,GAAG,CAAC,GAAG,CAAC;EACpD,OAAOH,QAAQ,CAACK,SAAS,CAAC,IAAIL,QAAQ,CAACM,YAAY,CAAC;AACtD;AAEA,SAASd,GAAGA,GAGJ;EAAA,+EAAJ,CAAC,CAAC;IAAAe,kBAFJR,KAAK;IAALA,KAAK,2BAAG,KAAK;IACbE,SAAS,QAATA,SAAS;EAET,IAAIO,qBAAqB,EAAEC,UAAU;EAErC,IAAMC,GAAG,GAAG,CAACF,qBAAqB,GAAG,CAACC,UAAU,GAAGR,SAAS,KAAK,IAAI,GAAG,KAAK,CAAC,GAAGQ,UAAU,CAACE,aAAa,KAAK,IAAI,GAAGH,qBAAqB,GAAGI,QAAQ;EACrJ,IAAMC,eAAe,GAAG,CAAC,CAAC,EAAEnB,MAAM,CAACoB,gBAAgB,EAAEJ,GAAG,CAAC;EAEzD,IAAI,CAACT,SAAS,EAAE;IACdA,SAAS,GAAGS,GAAG;EACjB;EAEA,IAAMK,iBAAiB,GAAGd,SAAS,CAACe,gBAAgB,CAACtB,MAAM,CAACuB,kBAAkB,CAAC;EAC/E,IAAMC,eAAe,GAAGC,KAAK,CAACC,IAAI,CAACL,iBAAiB,CAAC,CAACM,MAAM,CAAC,YAAE;IAAA,OAAIC,EAAE,KAAKT,eAAe,IAAIS,EAAE,CAACC,YAAY,CAAC,UAAU,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE7B,MAAM,CAAC8B,UAAU,EAAEF,EAAE,CAAC;IAAI;IACpK,CAAC,CAAC,EAAE5B,MAAM,CAAC+B,SAAS,EAAEH,EAAE,CAAC;EAAA,EAAC;EAC1B,IAAIJ,eAAe,CAACf,MAAM,KAAK,CAAC,EAAE;EAClC,IAAMuB,eAAe,GAAGR,eAAe,CAACS,GAAG,CAAC,UAACL,EAAE,EAAEM,GAAG;IAAA,OAAM;MACxDN,EAAE,EAAFA,EAAE;MACFM,GAAG,EAAHA;IACF,CAAC;EAAA,CAAC,CAAC,CAACC,IAAI,CAAC,UAACC,CAAC,EAAEC,CAAC,EAAK;IACjB;IACA,IAAIlB,eAAe,IAAIA,eAAe,CAACU,YAAY,CAAC,UAAU,CAAC,KAAK,IAAI,EAAE;MACxE,OAAOO,CAAC,CAACF,GAAG,GAAGG,CAAC,CAACH,GAAG;IACtB;IAEA,IAAMI,SAAS,GAAGC,MAAM,CAACH,CAAC,CAACR,EAAE,CAACC,YAAY,CAAC,UAAU,CAAC,CAAC;IACvD,IAAMW,SAAS,GAAGD,MAAM,CAACF,CAAC,CAACT,EAAE,CAACC,YAAY,CAAC,UAAU,CAAC,CAAC;IACvD,IAAMY,IAAI,GAAGH,SAAS,GAAGE,SAAS;IAClC,OAAOC,IAAI,KAAK,CAAC,GAAGL,CAAC,CAACF,GAAG,GAAGG,CAAC,CAACH,GAAG,GAAGO,IAAI;EAC1C,CAAC,CAAC,CAACR,GAAG,CAAC;IAAA,IACLL,EAAE,SAAFA,EAAE;IAAA,OACEA,EAAE;EAAA,EAAC,CAAC,CAAC;;EAEX,IAAMc,YAAY,GAAG,CAAC,CAAC;EACvB,IAAIC,cAAc,GAAG,EAAE;EACvBX,eAAe,CAACY,OAAO,CAAC,wBAAc,EAAI;IACxC;IACA;IACA;IACA,IAAMhB,EAAE,GAAGiB,cAAc;IAEzB,IAAIjB,EAAE,CAACkB,IAAI,KAAK,OAAO,IAAIlB,EAAE,CAACmB,IAAI,EAAE;MAClC;MACA,IAAMC,IAAI,GAAG7B,eAAe;MAE5B,IAAI6B,IAAI,IAAIA,IAAI,CAACF,IAAI,KAAKlB,EAAE,CAACkB,IAAI,IAAIE,IAAI,CAACD,IAAI,KAAKnB,EAAE,CAACmB,IAAI,EAAE;QAC1D,IAAInB,EAAE,KAAKoB,IAAI,EAAE;UACfL,cAAc,CAACM,IAAI,CAACrB,EAAE,CAAC;QACzB;QAEA;MACF,CAAC,CAAC;;MAGF,IAAIA,EAAE,CAACsB,OAAO,EAAE;QACdP,cAAc,GAAGA,cAAc,CAAChB,MAAM,CAAC,WAAC;UAAA,OAAIwB,CAAC,CAACL,IAAI,KAAKlB,EAAE,CAACkB,IAAI,IAAIK,CAAC,CAACJ,IAAI,KAAKnB,EAAE,CAACmB,IAAI;QAAA,EAAC;QACrFJ,cAAc,CAACM,IAAI,CAACrB,EAAE,CAAC;QACvBc,YAAY,CAACd,EAAE,CAACmB,IAAI,CAAC,GAAGnB,EAAE;QAC1B;MACF,CAAC,CAAC;;MAGF,IAAI,OAAOc,YAAY,CAACd,EAAE,CAACmB,IAAI,CAAC,KAAK,WAAW,EAAE;QAChD;MACF;IACF;IAEAJ,cAAc,CAACM,IAAI,CAACrB,EAAE,CAAC;EACzB,CAAC,CAAC;EACF,IAAMwB,KAAK,GAAGT,cAAc,CAACU,SAAS,CAAC,YAAE;IAAA,OAAIzB,EAAE,KAAKT,eAAe;EAAA,EAAC;EACpE,IAAMmC,WAAW,GAAGnD,cAAc,CAACiD,KAAK,EAAE/C,KAAK,EAAEsC,cAAc,EAAEpC,SAAS,CAAC;EAC3E,IAAMgD,YAAY,GAAG;IACnBC,GAAG,EAAE,OAAO;IACZC,OAAO,EAAE,EAAE;IACXC,QAAQ,EAAE;EACZ,CAAC;EACD,IAAMC,UAAU,GAAG;IACjBH,GAAG,EAAE,KAAK;IACVC,OAAO,EAAE,CAAC;IACVC,QAAQ,EAAErD;EACZ,CAAC;EACD,IAAIuD,aAAa,GAAG,IAAI,CAAC,CAAC;EAC1B;;EAEA,IAAIzC,eAAe,EAAE;IACnB;IACA,IAAId,KAAK,EAAEN,IAAI,CAAC8D,SAAS,CAACC,OAAO,CAAC3C,eAAe,oBAAOoC,YAAY,EAClE;IACFK,aAAa,GAAG7D,IAAI,CAAC8D,SAAS,CAACC,OAAO,CAAC3C,eAAe,oBAAOwC,UAAU,EACrE;EACJ;EAEA,IAAMI,WAAW,GAAG,CAACH,aAAa,IAAIzC,eAAe,GAAGA,eAAe,GAAGmC,WAAW;EAErF,IAAIM,aAAa,EAAE;IACjB,IAAIN,WAAW,KAAKtC,GAAG,CAACN,IAAI,EAAE;MAC5B;MACA,IAAIS,eAAe,EAAE;QACnB,CAAC,CAAC,EAAEjB,KAAK,CAAC8D,IAAI,EAAE7C,eAAe,CAAC;MAClC;IACF,CAAC,MAAM;MACL,CAAC,CAAC,EAAElB,MAAM,CAACgE,KAAK,EAAEX,WAAW,CAAC;IAChC;EACF;EAEAvD,IAAI,CAAC8D,SAAS,CAACK,KAAK,CAACH,WAAW,oBAAOJ,UAAU,EAC/C;EAEF,IAAItD,KAAK,EAAE;IACTN,IAAI,CAAC8D,SAAS,CAACK,KAAK,CAACH,WAAW,oBAAOR,YAAY;MACjDG,QAAQ,EAAE;IAAK,GACf;EACJ;AACF;AACA;AACA;AACA;AACA;AACA","names":["require","Object","defineProperty","exports","value","tab","_dom","_utils","_focus","_blur","getNextElement","currentIndex","shift","elements","focusTrap","isDocument","length","body","nextIndex","defaultIndex","_ref$shift","_focusTrap$ownerDocum","_focusTrap","doc","ownerDocument","document","previousElement","getActiveElement","focusableElements","querySelectorAll","FOCUSABLE_SELECTOR","enabledElements","Array","from","filter","el","getAttribute","isDisabled","isVisible","orderedElements","map","idx","sort","a","b","tabIndexA","Number","tabIndexB","diff","checkedRadio","prunedElements","forEach","currentElement","type","name","prev","push","checked","e","index","findIndex","nextElement","shiftKeyInit","key","keyCode","shiftKey","tabKeyInit","continueToTab","fireEvent","keyDown","keyUpTarget","blur","focus","keyUp"],"sources":["/home/bruno/repos/libs/lib-y/node_modules/@testing-library/user-event/dist/tab.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.tab = tab;\n\nvar _dom = require(\"@testing-library/dom\");\n\nvar _utils = require(\"./utils\");\n\nvar _focus = require(\"./focus\");\n\nvar _blur = require(\"./blur\");\n\nfunction getNextElement(currentIndex, shift, elements, focusTrap) {\n  if ((0, _utils.isDocument)(focusTrap) && (currentIndex === 0 && shift || currentIndex === elements.length - 1 && !shift)) {\n    return focusTrap.body;\n  }\n\n  const nextIndex = shift ? currentIndex - 1 : currentIndex + 1;\n  const defaultIndex = shift ? elements.length - 1 : 0;\n  return elements[nextIndex] || elements[defaultIndex];\n}\n\nfunction tab({\n  shift = false,\n  focusTrap\n} = {}) {\n  var _focusTrap$ownerDocum, _focusTrap;\n\n  const doc = (_focusTrap$ownerDocum = (_focusTrap = focusTrap) == null ? void 0 : _focusTrap.ownerDocument) != null ? _focusTrap$ownerDocum : document;\n  const previousElement = (0, _utils.getActiveElement)(doc);\n\n  if (!focusTrap) {\n    focusTrap = doc;\n  }\n\n  const focusableElements = focusTrap.querySelectorAll(_utils.FOCUSABLE_SELECTOR);\n  const enabledElements = Array.from(focusableElements).filter(el => el === previousElement || el.getAttribute('tabindex') !== '-1' && !(0, _utils.isDisabled)(el) && // Hidden elements are not tabable\n  (0, _utils.isVisible)(el));\n  if (enabledElements.length === 0) return;\n  const orderedElements = enabledElements.map((el, idx) => ({\n    el,\n    idx\n  })).sort((a, b) => {\n    // tabindex has no effect if the active element has tabindex=\"-1\"\n    if (previousElement && previousElement.getAttribute('tabindex') === '-1') {\n      return a.idx - b.idx;\n    }\n\n    const tabIndexA = Number(a.el.getAttribute('tabindex'));\n    const tabIndexB = Number(b.el.getAttribute('tabindex'));\n    const diff = tabIndexA - tabIndexB;\n    return diff === 0 ? a.idx - b.idx : diff;\n  }).map(({\n    el\n  }) => el); // TODO: verify/remove type casts\n\n  const checkedRadio = {};\n  let prunedElements = [];\n  orderedElements.forEach(currentElement => {\n    // For radio groups keep only the active radio\n    // If there is no active radio, keep only the checked radio\n    // If there is no checked radio, treat like everything else\n    const el = currentElement;\n\n    if (el.type === 'radio' && el.name) {\n      // If the active element is part of the group, add only that\n      const prev = previousElement;\n\n      if (prev && prev.type === el.type && prev.name === el.name) {\n        if (el === prev) {\n          prunedElements.push(el);\n        }\n\n        return;\n      } // If we stumble upon a checked radio, remove the others\n\n\n      if (el.checked) {\n        prunedElements = prunedElements.filter(e => e.type !== el.type || e.name !== el.name);\n        prunedElements.push(el);\n        checkedRadio[el.name] = el;\n        return;\n      } // If we already found the checked one, skip\n\n\n      if (typeof checkedRadio[el.name] !== 'undefined') {\n        return;\n      }\n    }\n\n    prunedElements.push(el);\n  });\n  const index = prunedElements.findIndex(el => el === previousElement);\n  const nextElement = getNextElement(index, shift, prunedElements, focusTrap);\n  const shiftKeyInit = {\n    key: 'Shift',\n    keyCode: 16,\n    shiftKey: true\n  };\n  const tabKeyInit = {\n    key: 'Tab',\n    keyCode: 9,\n    shiftKey: shift\n  };\n  let continueToTab = true; // not sure how to make it so there's no previous element...\n  // istanbul ignore else\n\n  if (previousElement) {\n    // preventDefault on the shift key makes no difference\n    if (shift) _dom.fireEvent.keyDown(previousElement, { ...shiftKeyInit\n    });\n    continueToTab = _dom.fireEvent.keyDown(previousElement, { ...tabKeyInit\n    });\n  }\n\n  const keyUpTarget = !continueToTab && previousElement ? previousElement : nextElement;\n\n  if (continueToTab) {\n    if (nextElement === doc.body) {\n      /* istanbul ignore else */\n      if (previousElement) {\n        (0, _blur.blur)(previousElement);\n      }\n    } else {\n      (0, _focus.focus)(nextElement);\n    }\n  }\n\n  _dom.fireEvent.keyUp(keyUpTarget, { ...tabKeyInit\n  });\n\n  if (shift) {\n    _dom.fireEvent.keyUp(keyUpTarget, { ...shiftKeyInit,\n      shiftKey: false\n    });\n  }\n}\n/*\neslint\n  complexity: \"off\",\n  max-statements: \"off\",\n*/"]},"metadata":{},"sourceType":"script","externalDependencies":[]}